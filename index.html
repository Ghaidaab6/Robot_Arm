<!DOCTYPE html>
<html>
<head>
    <title>Robot Arm Control Panel</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        .slider { width: 200px; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        button { margin: 5px; }
    </style>
</head>
<body>
    <h2>Robot Arm Control Panel</h2>

    <div id="sliders">
        <div>Motor 1: <input type="range" min="0" max="180" value="90" id="motor1" class="slider" oninput="updateValue(1)"> <span id="val1">90</span></div>
        <div>Motor 2: <input type="range" min="0" max="180" value="90" id="motor2" class="slider" oninput="updateValue(2)"> <span id="val2">90</span></div>
        <div>Motor 3: <input type="range" min="0" max="180" value="90" id="motor3" class="slider" oninput="updateValue(3)"> <span id="val3">90</span></div>
        <div>Motor 4: <input type="range" min="0" max="180" value="90" id="motor4" class="slider" oninput="updateValue(4)"> <span id="val4">90</span></div>
        <div>Motor 5: <input type="range" min="0" max="180" value="90" id="motor5" class="slider" oninput="updateValue(5)"> <span id="val5">90</span></div>
        <div>Motor 6: <input type="range" min="0" max="180" value="90" id="motor6" class="slider" oninput="updateValue(6)"> <span id="val6">90</span></div>
    </div>

    <br>
    <button onclick="resetSliders()">Reset</button>
    <button onclick="savePose()">Save Pose</button>
    <button onclick="runSequence()">Run</button>

    <table id="poseTable">
        <thead>
            <tr>
                <th>#</th>
                <th>Motor 1</th>
                <th>Motor 2</th>
                <th>Motor 3</th>
                <th>Motor 4</th>
                <th>Motor 5</th>
                <th>Motor 6</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        function updateValue(motor) {
            document.getElementById("val" + motor).innerText = document.getElementById("motor" + motor).value;
        }
        
        function resetSliders() {
            for (let i = 1; i <= 6; i++) {
                document.getElementById("motor" + i).value = 90;
                updateValue(i);
            }
        }
        
        function savePose() {
            let data = {};
            for (let i = 1; i <= 6; i++) {
                data["motor" + i] = document.getElementById("motor" + i).value;
            }
        
            fetch("save_pose.php", {
                method: "POST",
                body: JSON.stringify(data)
            }).then(res => res.json())
            .then(() => loadPoses());
        }
        
        function runSequence() {
            let data = {};
            for (let i = 1; i <= 6; i++) {
                data["motor" + i] = parseInt(document.getElementById("motor" + i).value);
            }

            fetch("run_sequence.php", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            })
            .then(res => res.json())
            .then(response => {
                if (response.success) {
                    alert("Current pose sent to run table!");
                } else {
                  alert("Error: " + response.message);
                }
            });
        }


        
        function loadPoses() {
            fetch("get_poses.php")
            .then(res => res.json())
            .then(data => {
                let tbody = document.querySelector("#poseTable tbody");
                tbody.innerHTML = "";
                data.forEach((pose, index) => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${index+1}</td>
                            <td>${pose.motor1}</td>
                            <td>${pose.motor2}</td>
                            <td>${pose.motor3}</td>
                            <td>${pose.motor4}</td>
                            <td>${pose.motor5}</td>
                            <td>${pose.motor6}</td>
                            <td>
                                <button onclick="loadPose(${pose.id})">Load</button>
                                <button onclick="removePose(${pose.id})">Remove</button>
                            </td>
                        </tr>`;
                });
            });
        }
        
        function loadPose(id) {
            fetch(`load_pose.php?id=${id}`)
            .then(res => res.json())
            .then(pose => {
                for (let i = 1; i <= 6; i++) {
                    document.getElementById("motor" + i).value = pose["motor" + i];
                    updateValue(i);
                }
            });
        }
        
        function removePose(id) {
            fetch(`remove_pose.php?id=${id}`, { method: "DELETE" })
            .then(() => loadPoses());
        }
        
        // Load table on startup
        loadPoses();
        </script>
        
</body>
</html>
